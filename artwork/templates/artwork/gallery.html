{% extends 'base.html' %}
{% load static %}

{% block title %}Art Gallery - Aiza's Fine Art{% endblock %}
{% block meta_description %}Browse Aiza's collection of original watercolor and oil paintings. Unique artworks from Fort Worth, Texas featuring landscapes, portraits, and abstract pieces.{% endblock %}

{% block extra_css %}
<style>
.filter-sidebar {
    position: sticky;
    top: 100px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
}
</style>
{% endblock %}

{% block content %}
<!-- Gallery Header -->
<section class="py-16 bg-gradient-subtle from-primary-50 to-secondary-50">
    <div class="container mx-auto px-4">
        <div class="text-center max-w-3xl mx-auto">
            <h1 class="text-h1 font-playfair font-bold text-neutral-800 mb-4">Art Gallery</h1>
            <p class="text-body-lg text-neutral-600 leading-relaxed">
                Explore a curated collection of original watercolor and oil paintings, 
                each piece capturing unique moments of beauty, emotion, and inspiration.
            </p>
        </div>
    </div>
</section>

<!-- Gallery Content -->
<section class="py-12">
    <div class="container mx-auto px-4">
        <div class="grid lg:grid-cols-4 gap-8">
            <!-- Filters Sidebar -->
            <aside class="lg:col-span-1">
                <div class="filter-sidebar card p-6">
                    <h3 class="font-playfair font-semibold text-lg text-neutral-800 mb-6">Filter Artworks</h3>
                    
                    <!-- Search -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Search</label>
                        <form action="{% url 'artwork:search' %}" method="get">
                            <div class="relative">
                                <input type="search" 
                                       name="q" 
                                       value="{{ request.GET.q }}"
                                       placeholder="Search artworks..." 
                                       class="artwork-search w-full pl-10 pr-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                                <svg class="absolute left-3 top-2.5 w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </form>
                    </div>

                    <!-- Categories Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-neutral-700 mb-3">Categories</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="filter-checkbox" data-filter="category" value="" 
                                       {% if not current_filters.category %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">All Categories</span>
                            </label>
                            {% for category in categories %}
                            <label class="flex items-center">
                                <input type="checkbox" class="filter-checkbox" data-filter="category" value="{{ category.slug }}"
                                       {% if current_filters.category == category.slug %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">{{ category.name }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Medium Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-neutral-700 mb-3">Medium</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="filter-checkbox" data-filter="medium" value=""
                                       {% if not current_filters.medium %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">All Mediums</span>
                            </label>
                            {% for value, display in mediums %}
                            <label class="flex items-center">
                                <input type="checkbox" class="filter-checkbox" data-filter="medium" value="{{ value }}"
                                       {% if current_filters.medium == value %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">{{ display }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Price Range Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-neutral-700 mb-3">Price Range</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="price_range" class="filter-radio" value=""
                                       {% if not current_filters.price_range %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">All Prices</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="price_range" class="filter-radio" value="under_500"
                                       {% if current_filters.price_range == 'under_500' %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">Under $500</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="price_range" class="filter-radio" value="500_1000"
                                       {% if current_filters.price_range == '500_1000' %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">$500 - $1,000</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="price_range" class="filter-radio" value="over_1000"
                                       {% if current_filters.price_range == 'over_1000' %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">Over $1,000</span>
                            </label>
                        </div>
                    </div>

                    <!-- Status Filter -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-neutral-700 mb-3">Availability</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="status" class="filter-radio" value=""
                                       {% if not current_filters.status %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">All Artworks</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="status" class="filter-radio" value="available"
                                       {% if current_filters.status == 'available' %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">Available</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="status" class="filter-radio" value="sold"
                                       {% if current_filters.status == 'sold' %}checked{% endif %}>
                                <span class="ml-2 text-sm text-neutral-600">Sold</span>
                            </label>
                        </div>
                    </div>

                    <!-- Clear Filters -->
                    <button type="button" class="clear-filters w-full btn-outline text-sm">
                        Clear All Filters
                    </button>
                </div>
            </aside>

            <!-- Main Gallery -->
            <main class="lg:col-span-3">
                <!-- Sort and Results Header -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                    <div class="text-sm text-neutral-600">
                        Showing {{ artworks|length }} of {{ paginator.count }} artworks
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <!-- View Toggle -->
                        <div class="flex items-center bg-neutral-100 rounded-lg p-1">
                            <button class="view-toggle active px-3 py-1 rounded text-sm" data-view="masonry">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2 4a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2V4zm2 0v4h4V4H4zm6 0v4h4V4h-4zM4 10v4h4v-4H4zm6 0v4h4v-4h-4z"></path>
                                </svg>
                            </button>
                            <button class="view-toggle px-3 py-1 rounded text-sm" data-view="grid">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Sort Dropdown -->
                        <select class="sort-select form-select text-sm">
                            <option value="newest" {% if current_filters.sort == 'newest' %}selected{% endif %}>Newest First</option>
                            <option value="oldest" {% if current_filters.sort == 'oldest' %}selected{% endif %}>Oldest First</option>
                            <option value="price_low" {% if current_filters.sort == 'price_low' %}selected{% endif %}>Price: Low to High</option>
                            <option value="price_high" {% if current_filters.sort == 'price_high' %}selected{% endif %}>Price: High to Low</option>
                            <option value="title" {% if current_filters.sort == 'title' %}selected{% endif %}>Title A-Z</option>
                        </select>
                    </div>
                </div>

                <!-- Artworks Grid -->
                <div class="masonry-grid artwork-gallery" data-current-page="1">
                    {% for artwork in artworks %}
                    <div class="masonry-item artwork-item" 
                         data-categories="{{ artwork.category.slug }}"
                         data-medium="{{ artwork.medium }}"
                         data-title="{{ artwork.title }}"
                         data-price="{{ artwork.price|default:'0' }}"
                         data-created="{{ artwork.created_at|date:'c' }}">
                        
                        <div class="masonry-content card artwork-card">
                            <a href="{{ artwork.get_absolute_url }}" class="artwork-link block" 
                               data-lightbox="true" 
                               data-image="{% if artwork.primary_image %}{{ artwork.primary_image.url }}{% endif %}"
                               data-title="{{ artwork.title }}" 
                               data-description="{{ artwork.description|truncatewords:20 }}"
                               data-price="{{ artwork.price_display }}">
                                
                                <div class="artwork-image-container relative overflow-hidden">
                                    {% if artwork.primary_image %}
                                        <img src="{{ artwork.primary_image.url }}" 
                                             alt="{{ artwork.alt_text }}" 
                                             class="artwork-image w-full h-auto"
                                             loading="lazy">
                                    {% else %}
                                        <div class="artwork-image w-full h-64 bg-gradient-to-br from-neutral-100 to-neutral-200 flex items-center justify-center">
                                            <span class="text-neutral-400">No Image</span>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="artwork-overlay">
                                        <div class="absolute bottom-4 left-4 text-white">
                                            <h3 class="font-playfair font-semibold text-lg mb-1">{{ artwork.title }}</h3>
                                            <p class="text-sm opacity-90">{{ artwork.get_medium_display }} • {{ artwork.dimensions_display }}</p>
                                        </div>
                                        
                                        {% if artwork.price %}
                                        <div class="absolute top-4 right-4 bg-white/20 backdrop-blur-sm rounded-full px-3 py-1 text-white text-sm font-medium">
                                            {{ artwork.price_display }}
                                        </div>
                                        {% endif %}
                                        
                                        <!-- Status Badge -->
                                        <div class="absolute top-4 left-4">
                                            <span class="status-{{ artwork.status }} text-xs px-2 py-1 rounded-full">
                                                {{ artwork.get_status_display }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            
                            <!-- Artwork Info (visible in grid view) -->
                            <div class="artwork-info p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-playfair font-semibold text-lg text-neutral-800">
                                        <a href="{{ artwork.get_absolute_url }}" class="hover:text-primary-600">{{ artwork.title }}</a>
                                    </h3>
                                    {% if user.is_authenticated %}
                                    <button class="wishlist-toggle ml-2 p-1 text-neutral-400 hover:text-red-500 transition-colors"
                                            data-artwork-id="{{ artwork.id }}">
                                        <span class="wishlist-icon">
                                            {% if artwork.id in user.wishlists.values_list %}❤️{% else %}🤍{% endif %}
                                        </span>
                                    </button>
                                    {% endif %}
                                </div>
                                
                                <p class="text-sm text-neutral-600 mb-3">{{ artwork.get_medium_display }} • {{ artwork.dimensions_display }}</p>
                                
                                <div class="flex justify-between items-center">
                                    <div class="price-display">{{ artwork.price_display }}</div>
                                    <a href="{% url 'artwork:inquiry' artwork.id %}" 
                                       class="btn-primary btn-sm">
                                        Inquire
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">🎨</div>
                        <h3 class="text-xl font-playfair font-semibold mb-2">No artworks found</h3>
                        <p class="text-neutral-600 mb-6">Try adjusting your filters or search terms</p>
                        <button class="clear-filters btn-primary">Clear Filters</button>
                    </div>
                    {% endfor %}
                </div>

                <!-- Load More / Pagination -->
                {% if page_obj.has_next %}
                <div class="text-center mt-12">
                    <div class="load-more inline-block">
                        <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}" 
                           class="btn-primary">
                            Load More Artworks
                        </a>
                    </div>
                </div>
                {% endif %}

                <!-- Traditional Pagination (fallback) -->
                {% if paginator.num_pages > 1 %}
                <nav class="pagination mt-12 flex justify-center">
                    <div class="flex items-center space-x-2">
                        {% if page_obj.has_previous %}
                            <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}" 
                               class="px-3 py-2 border border-neutral-300 rounded-lg hover:bg-neutral-50 transition-colors">Previous</a>
                        {% endif %}

                        {% for page_num in paginator.page_range %}
                            {% if page_num == page_obj.number %}
                                <span class="px-3 py-2 bg-primary-500 text-white rounded-lg">{{ page_num }}</span>
                            {% else %}
                                <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_num }}" 
                                   class="px-3 py-2 border border-neutral-300 rounded-lg hover:bg-neutral-50 transition-colors">{{ page_num }}</a>
                            {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                            <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}" 
                               class="px-3 py-2 border border-neutral-300 rounded-lg hover:bg-neutral-50 transition-colors">Next</a>
                        {% endif %}
                    </div>
                </nav>
                {% endif %}
            </main>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'dist/js/gallery.bundle.js' %}"></script>
{% endblock %}