<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Order - {{ order.order_number }}</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: #dc3545; color: white; text-align: center; padding: 20px; border-radius: 8px 8px 0 0; }
        .content { background: #ffffff; padding: 30px; border: 1px solid #e5e5e5; }
        .alert { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .order-info { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .order-items { margin: 20px 0; }
        .order-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #e5e5e5; }
        .order-item:last-child { border-bottom: none; }
        .item-details { flex-grow: 1; }
        .item-title { font-weight: bold; margin-bottom: 5px; }
        .totals { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .total-row { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .total-row.final { font-weight: bold; font-size: 18px; border-top: 2px solid #ddd; padding-top: 10px; margin-top: 15px; }
        .addresses { display: flex; gap: 20px; margin: 20px 0; }
        .address { flex: 1; background: #f8f9fa; padding: 15px; border-radius: 8px; }
        .address h4 { margin-top: 0; color: #dc3545; }
        .actions { text-align: center; margin: 20px 0; }
        .button { display: inline-block; background: #dc3545; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; margin: 5px; }
        .button.secondary { background: #6c757d; }
        .status-badge { background: #28a745; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .print-orders { background: #e7f3ff; border: 1px solid #b3d7ff; padding: 15px; border-radius: 8px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® New Order Received!</h1>
            <p>Order {{ order.order_number }} - ${{ order.total_amount }}</p>
        </div>
        
        <div class="content">
            <div class="alert">
                <strong>Action Required:</strong> A new order has been placed and needs processing.
            </div>
            
            <div class="order-info">
                <h2>Order Information</h2>
                <p><strong>Order Number:</strong> {{ order.order_number }}</p>
                <p><strong>Order Date:</strong> {{ order.created_at|date:"F j, Y g:i A" }}</p>
                <p><strong>Customer:</strong> {{ order.billing_name }} ({{ order.billing_email }})</p>
                {% if order.billing_phone %}
                <p><strong>Phone:</strong> {{ order.billing_phone }}</p>
                {% endif %}
                <p><strong>Payment Status:</strong> <span class="status-badge">{{ order.get_payment_status_display }}</span></p>
                <p><strong>Stripe Payment ID:</strong> {{ order.stripe_payment_intent_id }}</p>
            </div>
            
            <div class="order-items">
                <h3>Items to Process</h3>
                {% for item in order.items.all %}
                <div class="order-item">
                    <div class="item-details">
                        <div class="item-title">{{ item.title }}</div>
                        <div style="color: #666;">{{ item.description }}</div>
                        <div><strong>Type:</strong> {{ item.get_item_type_display }}</div>
                        <div><strong>Quantity:</strong> {{ item.quantity }}</div>
                        {% if item.print_size %}
                        <div><strong>Print Size:</strong> {{ item.print_size }}</div>
                        {% endif %}
                    </div>
                    <div style="font-weight: bold; color: #dc3545;">${{ item.total_price }}</div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Check for print orders that need Luma Prints processing -->
            {% with print_items=order.items.all %}
                {% for item in print_items %}
                    {% if 'print' in item.item_type and forloop.first %}
                        <div class="print-orders">
                            <h4>üñ®Ô∏è Print Order Processing Required</h4>
                            <p><strong>Luma Prints Integration Needed:</strong></p>
                            <ul>
                                {% for print_item in print_items %}
                                    {% if 'print' in print_item.item_type %}
                                    <li>{{ print_item.artwork.title }} - {{ print_item.get_item_type_display }} (Qty: {{ print_item.quantity }})</li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                            <p><em>This order contains prints that need to be sent to Luma Prints for fulfillment.</em></p>
                        </div>
                    {% endif %}
                {% endfor %}
            {% endwith %}
            
            <div class="totals">
                <h3>Order Financial Summary</h3>
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span>${{ order.subtotal }}</span>
                </div>
                <div class="total-row">
                    <span>Shipping:</span>
                    <span>${{ order.shipping_amount }}</span>
                </div>
                <div class="total-row">
                    <span>Tax (8.25%):</span>
                    <span>${{ order.tax_amount }}</span>
                </div>
                <div class="total-row final">
                    <span>Total Paid:</span>
                    <span>${{ order.total_amount }}</span>
                </div>
            </div>
            
            <div class="addresses">
                <div class="address">
                    <h4>Billing Address</h4>
                    <p>{{ order.billing_name }}<br>
                    {{ order.billing_address_display|linebreaks }}</p>
                </div>
                
                <div class="address">
                    <h4>Shipping Address</h4>
                    <p>{% if order.shipping_name %}{{ order.shipping_name }}{% else %}{{ order.billing_name }}{% endif %}<br>
                    {{ order.shipping_address_display|linebreaks }}</p>
                </div>
            </div>
            
            {% if order.notes %}
            <div class="order-info">
                <h4>Customer Notes</h4>
                <p><em>"{{ order.notes }}"</em></p>
            </div>
            {% endif %}
            
            <div class="actions">
                <a href="http://{{ request.get_host }}/admin/orders/order/{{ order.id }}/change/" class="button">
                    Process in Admin
                </a>
                <a href="http://{{ request.get_host }}{% url 'orders:confirmation' order.order_number %}" class="button secondary">
                    View Order
                </a>
            </div>
            
            <div class="order-info">
                <h4>Next Steps</h4>
                <ol>
                    <li><strong>Verify Payment:</strong> Confirm payment was processed successfully in Stripe</li>
                    <li><strong>Process Originals:</strong> Prepare original artworks for shipping with proper packaging</li>
                    <li><strong>Handle Prints:</strong> Send print orders to Luma Prints if applicable</li>
                    <li><strong>Update Status:</strong> Mark order as "processing" once work begins</li>
                    <li><strong>Ship & Track:</strong> Update with tracking information when items ship</li>
                </ol>
            </div>
        </div>
        
        <div style="text-align: center; padding: 20px; color: #666; font-size: 14px;">
            <p>This is an automated notification from your Aiza's Fine Art website.</p>
            <p>Order received at {{ order.created_at|date:"F j, Y g:i A T" }}</p>
        </div>
    </div>
</body>
</html>