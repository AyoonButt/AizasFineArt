{% extends 'base.html' %}
{% load static %}

{% block title %}Account Settings - Aiza's Fine Art{% endblock %}

{% block content %}
<section class="py-12 bg-neutral-50 min-h-screen">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-h1 font-playfair font-semibold text-neutral-800 mb-2">Account Settings</h1>
                <p class="text-body-lg text-neutral-600">Manage your privacy and notification preferences</p>
            </div>

            <!-- Back to Profile -->
            <div class="mb-6">
                <a href="{% url 'userprofiles:profile_dashboard' %}" class="inline-flex items-center text-sm text-neutral-600 hover:text-neutral-800">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L4.414 9H17a1 1 0 110 2H4.414l5.293 5.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                    </svg>
                    Back to Profile
                </a>
            </div>

            <!-- Settings Form -->
            <div class="bg-white rounded-xl shadow-sm border border-neutral-200 p-8">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Privacy Settings -->
                    <div class="mb-8">
                        <h2 class="text-lg font-playfair font-semibold text-neutral-800 mb-6 pb-3 border-b border-neutral-200">
                            Privacy Settings
                        </h2>
                        
                        <div class="space-y-6">
                            <div class="flex items-start space-x-3">
                                <input type="checkbox" 
                                       id="profile_public" 
                                       name="profile_public"
                                       {% if profile.profile_public %}checked{% endif %}
                                       class="mt-1 h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-2 focus:ring-primary-500">
                                <div>
                                    <label for="profile_public" class="text-sm font-medium text-neutral-800">Make my profile public</label>
                                    <p class="text-sm text-neutral-600 mt-1">Allow other users to view your profile information and art preferences.</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3">
                                <input type="checkbox" 
                                       id="show_purchase_history" 
                                       name="show_purchase_history"
                                       {% if profile.show_purchase_history %}checked{% endif %}
                                       class="mt-1 h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-2 focus:ring-primary-500">
                                <div>
                                    <label for="show_purchase_history" class="text-sm font-medium text-neutral-800">Show my purchase history</label>
                                    <p class="text-sm text-neutral-600 mt-1">Display your artwork purchases on your public profile (only if profile is public).</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Communication Preferences -->
                    <div class="mb-8">
                        <h2 class="text-lg font-playfair font-semibold text-neutral-800 mb-6 pb-3 border-b border-neutral-200">
                            Communication Preferences
                        </h2>
                        
                        <div class="space-y-6">
                            <div class="flex items-start space-x-3">
                                <input type="checkbox" 
                                       id="newsletter_subscription" 
                                       name="newsletter_subscription"
                                       {% if profile.newsletter_subscription %}checked{% endif %}
                                       class="mt-1 h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-2 focus:ring-primary-500">
                                <div>
                                    <label for="newsletter_subscription" class="text-sm font-medium text-neutral-800">Newsletter subscription</label>
                                    <p class="text-sm text-neutral-600 mt-1">Receive updates about new artwork, exhibitions, and special offers.</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3">
                                <input type="checkbox" 
                                       id="email_notifications" 
                                       name="email_notifications"
                                       {% if profile.email_notifications %}checked{% endif %}
                                       class="mt-1 h-4 w-4 text-primary-600 border-gray-300 rounded focus:ring-2 focus:ring-primary-500">
                                <div>
                                    <label for="email_notifications" class="text-sm font-medium text-neutral-800">Email notifications</label>
                                    <p class="text-sm text-neutral-600 mt-1">Receive email notifications for order updates, inquiries, and account activity.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Account Information -->
                    <div class="mb-8">
                        <h2 class="text-lg font-playfair font-semibold text-neutral-800 mb-6 pb-3 border-b border-neutral-200">
                            Account Information
                        </h2>
                        
                        <div class="grid md:grid-cols-2 gap-6 text-sm">
                            <div>
                                <p class="text-neutral-600">Account created</p>
                                <p class="font-medium text-neutral-800">{{ user.date_joined|date:"F d, Y" }}</p>
                            </div>
                            
                            <div>
                                <p class="text-neutral-600">Last active</p>
                                <p class="font-medium text-neutral-800">{{ profile.last_active|date:"F d, Y" }}</p>
                            </div>
                            
                            <div>
                                <p class="text-neutral-600">Total orders</p>
                                <p class="font-medium text-neutral-800">{{ user.orders.count }}</p>
                            </div>
                            
                            <div>
                                <p class="text-neutral-600">Wishlist items</p>
                                <p class="font-medium text-neutral-800">{{ user.wishlists.count }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Data Management -->
                    <div class="mb-8">
                        <h2 class="text-lg font-playfair font-semibold text-neutral-800 mb-6 pb-3 border-b border-neutral-200">
                            Data Management
                        </h2>
                        
                        <div class="space-y-4">
                            {% if profile.stripe_customer_id %}
                            <div class="flex items-center justify-between p-4 border border-neutral-200 rounded-lg">
                                <div>
                                    <h3 class="font-medium text-neutral-800">Sync billing data</h3>
                                    <p class="text-sm text-neutral-600">Update your profile with the latest billing information from Stripe.</p>
                                </div>
                                <form method="post" action="{% url 'userprofiles:sync_stripe_data' %}" class="inline">
                                    {% csrf_token %}
                                    <button type="submit" class="px-4 py-2 text-sm font-medium text-primary-600 border border-primary-300 rounded-lg hover:bg-primary-50 transition-colors">
                                        Sync Now
                                    </button>
                                </form>
                            </div>
                            {% endif %}
                            
                            <div class="flex items-center justify-between p-4 border border-red-200 rounded-lg bg-red-50">
                                <div>
                                    <h3 class="font-medium text-red-800">Delete account</h3>
                                    <p class="text-sm text-red-600">Permanently delete your account and all associated data.</p>
                                </div>
                                <a href="{% url 'userprofiles:delete_account_confirm' %}" class="px-4 py-2 text-sm font-medium text-red-600 border border-red-300 rounded-lg hover:bg-red-100 transition-colors">
                                    Delete Account
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex items-center justify-between pt-6 border-t border-neutral-200">
                        <a href="{% url 'userprofiles:profile_dashboard' %}" class="px-6 py-2 text-sm font-medium text-neutral-700 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-50 transition-colors">
                            Cancel
                        </a>
                        <button type="submit" class="px-6 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-lg hover:bg-primary-700 transition-colors">
                            Save Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}